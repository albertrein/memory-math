<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Math - Jogo</title>
    <link href="https://nostalgic-css.github.io/NES.css/style.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/nes.css/css/nes-core.min.css" rel="stylesheet" />
    <link href="./assets/style/style.css" rel="stylesheet" />
    <style>
        
    </style>
    <script>
        /*
            *To do
            * Verificar aqui se jogador está logado
            * Fazer fetch enviando quantidade de cartas de acordo com a dificuldade            
        */
        let cartas = [{
            "expressao" : "3+4",
            "resposta" : "7"
        },{
            "expressao" : "4-4",
            "resposta" : "0"
        }];

    </script>
</head>
<body>
    <div class="nescss">
        <header class="">
            <div class="container">
                <div class="nav-brand">
                    <a href="https://nostalgic-css.github.io/NES.css/">
                        <h1><i class="snes-jp-logo brand-logo"></i>Game</h1>
                    </a>
                    <p>Memory Math</p>
                </div>
                <div class="social-buttons">
                    <p>Jogo</p>
                </div>
            </div>
        </header>

    <div class="nes-container with-title is-centered">
        <p class="title" id="timerCounter"></p>
    </div>


    </div>
    <script lang="text/javascript">
        let timer = document.querySelector('#timerCounter');
        let timerCounter = 60 * 1000;
        let primeiraJogada = null;
        let quantidadeCartasAtivas = cartas.length;

        let startTimer = () => {
            setTimeout(() => {
                timer.textContent = timerCounter/1000;
                timerCounter -= 1000;
                if(timerCounter < 0){
                    alert("Você perdeu. Fim de jogo!");
                    //Soma pontos totais
                    //Envia para o ranking
                    return;
                }
                startTimer();
            },1000)
        }
        startTimer();
        
        let verificaFimDaEtapa = () => {
            quantidadeCartasAtivas--;
            if(quantidadeCartasAtivas <= 0){
                alert("Fim da etapa");
                //Verificador fim de jogo
                //Soma pontos totais
                //Envia para o ranking
            }
        }

        let verificaCartas = (card1, card2, callback) => new Promise((resolve, reject) => {
            if(card1.getAttribute("key") == card2.getAttribute("key")){
                //Soma Pontos
                verificaFimDaEtapa();
                resolve();
            }else{
                card1.className = "card";
                card2.className = "card";
                resolve();
            }
        });

        let makeMove = (card) => {
            card.className += " show"
            
            if(!primeiraJogada){
                primeiraJogada = card;
                return;
            }
            
            setTimeout(async () => {
                await verificaCartas(primeiraJogada, card);                    
                
                primeiraJogada = null;
                card = null;
            },500)
            
        }

        let makeElement = (text, key) => {
            let newCard = document.createElement('div');
            newCard.classList = "card";
            newCard.textContent = text;
            newCard.setAttribute('key', key);
            newCard.addEventListener('click',(el) => {
                makeMove(el.target)
            });
            containerElement.appendChild(newCard);
        }        

        let containerElement = document.querySelector('.nes-container');
        cartas.forEach((obj, key) => {
            makeElement(obj.expressao, key);
            makeElement(obj.resposta, key);
        });


    </script>
</body>
</html>